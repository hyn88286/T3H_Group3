CREATE DATABASE Sell_ThuCung_1;
USE Sell_ThuCung_1;

CREATE TABLE user (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name NVARCHAR(255) NULL,
  username VARCHAR(50),
  password VARCHAR(50),
  email VARCHAR(100),
  role_id BIGINT,
  deleted BOOLEAN DEFAULT false,
  created_date DATETIME DEFAULT CURRENT_TIMESTAMP,
  create_by INT,
  lastmodify_date DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  lastmodify_by INT,
  FOREIGN KEY (role_id) REFERENCES role(id),
  FOREIGN KEY (create_by) REFERENCES user(id),
  FOREIGN KEY (lastmodify_by) REFERENCES user(id)
);


CREATE TABLE role (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NULL,
    created_by INT,
    created_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    modified_by INT,
    modified_date DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (created_by) REFERENCES user(id),
    FOREIGN KEY (modified_by) REFERENCES user(id)
);

CREATE TABLE user_role (
    user_id INT NOT NULL,
    role_id BIGINT NOT NULL,
    PRIMARY KEY (user_id, role_id),
    FOREIGN KEY (user_id) REFERENCES user(id),
    FOREIGN KEY (role_id) REFERENCES role(id)
);

CREATE TABLE category(
  id INT AUTO_INCREMENT PRIMARY KEY,
  name NVARCHAR(100),
  deleted BOOLEAN DEFAULT false,
  created_date DATETIME DEFAULT CURRENT_TIMESTAMP,
  create_by INT,
  lastmodify_date DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  lastmodify_by INT,
  FOREIGN KEY (create_by) REFERENCES user(id),
  FOREIGN KEY (lastmodify_by) REFERENCES user(id)
);

CREATE TABLE product(
  id INT AUTO_INCREMENT PRIMARY KEY,
  name NVARCHAR(100),
  description NVARCHAR(800),
  price DECIMAL(10, 2),
  quantity INT,
  short_description NVARCHAR(1000),
  category_id INT,
  deleted BOOLEAN DEFAULT false,
  created_date DATETIME DEFAULT CURRENT_TIMESTAMP,
  create_by INT,
  lastmodify_date DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  lastmodify_by INT,
  FOREIGN KEY (category_id) REFERENCES category(id),
  FOREIGN KEY (create_by) REFERENCES user(id),
  FOREIGN KEY (lastmodify_by) REFERENCES user(id)
);

CREATE TABLE order1(
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT,
  order_date DATETIME DEFAULT CURRENT_TIMESTAMP,
  total_amount DECIMAL(10, 2),
  deleted BOOLEAN DEFAULT false,
  created_date DATETIME DEFAULT CURRENT_TIMESTAMP,
  create_by INT,
  lastmodify_date DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  lastmodify_by INT,
  FOREIGN KEY (user_id) REFERENCES user(id),
  FOREIGN KEY (create_by) REFERENCES user(id),
  FOREIGN KEY (lastmodify_by) REFERENCES user(id)
);

CREATE TABLE order_detail(
  id INT AUTO_INCREMENT PRIMARY KEY,
  order_id INT,
  product_id INT,
  quantity INT,
  price DECIMAL(10, 2),
  deleted BOOLEAN DEFAULT false,
  created_date DATETIME DEFAULT CURRENT_TIMESTAMP,
  create_by INT,
  lastmodify_date DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  lastmodify_by INT,
  FOREIGN KEY (order_id) REFERENCES order1(id),
  FOREIGN KEY (product_id) REFERENCES product(id),
  FOREIGN KEY (create_by) REFERENCES user(id),
  FOREIGN KEY (lastmodify_by) REFERENCES user(id)
);

CREATE TABLE comment(
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT,
  product_id INT,
  comment NVARCHAR(1000),
  deleted BOOLEAN DEFAULT false,
  created_date DATETIME DEFAULT CURRENT_TIMESTAMP,
  create_by INT,
  lastmodify_date DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  lastmodify_by INT,
  FOREIGN KEY (user_id) REFERENCES user(id),
  FOREIGN KEY (product_id) REFERENCES product(id),
  FOREIGN KEY (create_by) REFERENCES user(id),
  FOREIGN KEY (lastmodify_by) REFERENCES user(id)
);

CREATE TABLE rating(
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT,
  product_id INT,
  rating INT,
  review NVARCHAR(800),
  deleted BOOLEAN DEFAULT false,
  created_date DATETIME DEFAULT CURRENT_TIMESTAMP,
  create_by INT,
  lastmodify_date DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  lastmodify_by INT,
  FOREIGN KEY (user_id) REFERENCES user(id),
  FOREIGN KEY (product_id) REFERENCES product(id),
  FOREIGN KEY (create_by) REFERENCES user(id),
  FOREIGN KEY (lastmodify_by) REFERENCES user(id)
);

CREATE TABLE size(
  id BIGINT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(255) NULL,
  deleted BOOLEAN DEFAULT false,
  created_date DATETIME DEFAULT CURRENT_TIMESTAMP,
  create_by INT,
  lastmodify_date DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  lastmodify_by INT,
  FOREIGN KEY (create_by) REFERENCES user(id),
  FOREIGN KEY (lastmodify_by) REFERENCES user(id)
);
create table product_size(
    size_id       bigint       not null,
    product_id    bigint       not null,
    id            bigint       not null,
    created_by    varchar(255) null,
    created_date  datetime(6)  null,
    modified_by   varchar(255) null,
    modified_date datetime(6)  null,
    primary key (size_id, product_id),
    
        foreign key (product_id) references product (id),
    
        foreign key (size_id) references size (id)
);

CREATE TABLE permission(
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT,
  permission_level ENUM('user', 'admin'),
  deleted BOOLEAN DEFAULT false,
  created_date DATETIME DEFAULT CURRENT_TIMESTAMP,
  create_by INT,
  lastmodify_date DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  lastmodify_by INT,
  FOREIGN KEY (user_id) REFERENCES user(id),
  FOREIGN KEY (create_by) REFERENCES user(id),
  FOREIGN KEY (lastmodify_by) REFERENCES user(id)
);
